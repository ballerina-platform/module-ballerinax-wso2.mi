## Overview

This sample demonstrates the use of a connector generated by the Ballerina MI SDK to transform a JSON payload structure received by WSO2 MI into a different JSON structure.
In this example, the `mapper` resource, accepts a JSON payload containing patient details. The payload is mapped to a new structure through a transformation function implemented in Ballerina.

## Steps to Invoke the Sample

Follow these steps to invoke the sample using the connector:

1. The `bal-mapping` folder contains the Ballerina code for the connector. Invoke the following command to generate the connector:

    ```bash
    bal mi -i <ballerina-project>
    ```

2. A ZIP file of the connector will be generated. Add this ZIP file to the MI project inside the folder `mi-mapping` following the approach described [here](https://mi.docs.wso2.com/en/latest/develop/creating-artifacts/adding-connectors/).

3. Once the connector is added, run the MI project.

4. Send an HTTP POST request to the following resource with a payload as specified:

   ```bash
   curl --location 'http://localhost:8290/mapping' \
   --header 'Content-Type: application/json' \
   --data '{
      "patientType": "Patient",
      "patientId": "123456",
      "version": "1",
      "lastUpdatedOn": "2020-02-01T05:30:41.785+00:00",
      "originSource": "#hYoipn8902",
      "status": "generated",
      "identifiers": [
         {
            "id_type": {
            "codes": [
               {
                  "system_source": "http://hl7.org/fhir/v2/0203",
                  "identifier_code": "MR"
               }
            ]
            },
            "id_value": "1213I7-bhjasb-80232-82032-shab9201212"
         }
      ],
      "firstName": "Andrew",
      "lastName": "Simons",
      "description": {
         "status": "generated"
      },
      "gender": "male",
      "locationDetail": [
         {
            "nation": "US",
            "town": "Seattle",
            "region": "WA",
            "zipCode": "98101",
            "identifier": "5648223",
            "province": "WA"
         }
      ]
      }'
   ```

   Output:

   ```json
      {
      "result": {
         "name": [
               {
                  "given": [
                     "Andrew"
                  ],
                  "family": "Simons"
               }
         ],
         "meta": {
               "versionId": "1",
               "lastUpdated": "2020-02-01T05:30:41.785+00:00",
               "source": "#hYoipn8902"
         },
         "text": {
               "div": "",
               "status": "generated"
         },
         "gender": "male",
         "identifier": [
               {
                  "system": "http://hl7.org/fhir/v2/0203",
                  "value": "1213I7-bhjasb-80232-82032-shab9201212"
               }
         ],
         "address": [
               {
                  "country": "US",
                  "city": "Seattle",
                  "district": "WA",
                  "state": "WA",
                  "postalCode": "98101",
                  "id": "5648223"
               }
         ],
         "id": "123456"
      }
   }
   ```
